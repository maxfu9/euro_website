{% extends "templates/web.html" %}
{% block page_content %}
{% include "euro_website/templates/includes/site_nav.html" %}

<section class="page-hero">
  <div class="container">
    <p class="eyebrow">Store</p>
    <h1>Discover the collection.</h1>
    <p class="lead">Live pricing and inventory, directly from ERPNext.</p>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="store-toolbar">
      <div>Showing {{ products | length }} of {{ total_products }} items</div>
      <a class="btn btn-ghost" href="/cart">View Cart ({{ cart.items | length }})</a>
    </div>
    <form class="filter-bar" method="get">
      <div class="filter-field">
        <label>Search</label>
        <input type="text" name="q" placeholder="Search products" value="{{ filters.q }}" />
      </div>
      <div class="filter-field">
        <label>Category</label>
        <select name="category">
          <option value="">All categories</option>
          {% for cat in categories %}
            <option value="{{ cat }}" {% if filters.category == cat %}selected{% endif %}>{{ cat }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="filter-field">
        <label>Min price</label>
        <input type="number" name="min_price" min="0" step="0.01" value="{{ filters.min_price or '' }}" />
      </div>
      <div class="filter-field">
        <label>Max price</label>
        <input type="number" name="max_price" min="0" step="0.01" value="{{ filters.max_price or '' }}" />
      </div>
      <div class="filter-actions">
        <button class="btn btn-solid" type="submit">Apply</button>
        <a class="btn btn-ghost" href="/store">Reset</a>
      </div>
    </form>
    {% if products and products | length %}
      <div class="product-grid">
        {% for item in products %}
          <a class="product-card" href="/store/{{ item.route or item.item_code }}">
            <div class="product-media" style="background-image: url('{{ item.thumbnail or item.website_image or '/assets/frappe/images/ui/placeholder-image.png' }}')"></div>
            <div class="product-body">
              <div class="product-title">{{ item.item_name }}</div>
              <div class="product-price">{{ frappe.utils.fmt_money(item.standard_rate or 0) }}</div>
              <div class="product-cta">View details</div>
            </div>
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <h3>No products found</h3>
        <p class="muted">Try adjusting your filters or search.</p>
        <a class="btn btn-ghost" href="/store">Clear filters</a>
      </div>
    {% endif %}
    {% if total_pages > 1 %}
      {% set base_query = {"q": filters.q, "category": filters.category, "min_price": filters.min_price, "max_price": filters.max_price, "page_size": page_size} %}
      <div class="pager">
        {% if page > 1 %}
          <a class="btn btn-ghost" href="/store?{{ frappe.utils.urlencode(base_query) }}&page={{ page - 1 }}">Previous</a>
        {% endif %}
        <div class="pager-info">Page {{ page }} of {{ total_pages }}</div>
        {% if page < total_pages %}
          <a class="btn btn-ghost" href="/store?{{ frappe.utils.urlencode(base_query) }}&page={{ page + 1 }}">Next</a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</section>

{% include "euro_website/templates/includes/site_footer.html" %}
{% endblock %}
